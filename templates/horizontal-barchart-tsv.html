{% extends "layout.html" %}
{% block body %}
  <style>
  .chart rect {
    fill: steelblue;
  }
  .chart text {
    fill: steelblue;
    font: 10px sans-serif;
    text-anchor: end;
  }
  </style>
  <h1>count {{ request.path.split('/')[1]  }} in {{ request.path.split('/')[2].replace('.html','').replace('count_',' ') }}</h1>
  <svg class="chart"></svg>
{% endblock %}
{% block javascript %}
  <script>
  $(function(){
    var width = 900,
        barHeight = 10;
        xOffset = 100;

    var x = d3.scale.linear()
        .range([xOffset, width]);

    var chart = d3.select(".chart")
        .attr("width", width);

    d3.tsv("{{ data_url }}", type, function(error, data) {
      x.domain([0, d3.max(data, function(d) { return +d.frequency; })]);

      chart.attr("height", barHeight * data.length);

      var bar = chart.selectAll("g")
          .data(data)
          .enter().append("g")
          .attr("transform", function(d, i) { return "translate(" + xOffset + "," + i * barHeight + ")"; });

      bar.append("rect")
          .attr("width", function(d) { return x(+d.frequency); })
          .attr("height", barHeight - 1);

      bar.append("text")
          /* .attr("x", function(d) { return x(+d.frequency) - 3; }) */
          .attr("x", function(d) { return x(0) - xOffset - 3; })
          .attr("y", barHeight / 2)
          .attr("dy", ".35em")
          .text(function(d) { return d.label; });
    });

    function type(d) {
      d.frequency = +d.frequency; // coerce to number
      return d;
    }

  });
  </script>
{% endblock %}
